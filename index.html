<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>SMP NEGERI SATAP 4 BANAWA SELATAN</title>

<!-- Bootstrap 5 CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />

<!-- Tailwind CSS CDN -->
<script src="https://cdn.tailwindcss.com"></script>

<style>
  /* Override icon-book supaya bisa inline dan kecil */
  .icon-book {
    width: 16px;
    height: 16px;
    display: inline-block;
    background: url('https://cdn-icons-png.flaticon.com/512/29/29302.png') no-repeat center center;
    background-size: contain;
    vertical-align: middle;
    margin-right: 5px;
  }

  /* Sidebar styling */
  #sidebarMenu {
    min-width: 220px;
    max-width: 220px;
    background-color: #0d6efd; /* Bootstrap primary */
  }
  #sidebarMenu .nav-link {
    color: #fff;
  }
  #sidebarMenu .nav-link.active, 
  #sidebarMenu .nav-link:hover {
    background-color: #0b5ed7;
    color: #fff;
  }

  /* Body content padding to the left when sidebar visible on large screens */
  @media (min-width: 992px) {
    body {
      padding-left: 220px;
    }
  }
</style>
</head>
<body class="bg-light">

<!-- Sidebar -->
<nav id="sidebarMenu" class="d-lg-block sidebar collapse position-fixed h-100">
  <div class="position-sticky pt-3">
    <ul class="nav flex-column">
      <li class="nav-item">
        <a class="nav-link active" href="#rekap-data">
          <svg xmlns="http://www.w3.org/2000/svg" class="me-2" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
            <path d="M0 1a1 1 0 0 1 1-1h14a1 1 0 0 1 1 1v14a1 1 0 0 1-1 1H1a1 1 0 0 1-1-1V1zM1 0v16h14V0H1z"/>
            <path d="M4 12h2v-4H4v4zm6 0h2v-7h-2v7zM8 6h2V2H8v4z"/>
          </svg>
          Dashboard Data
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="#input-data">
          <svg xmlns="http://www.w3.org/2000/svg" class="me-2" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
            <path d="M15.854.146a.5.5 0 0 1 0 .708l-1.793 1.793-2.5-2.5L13.354.146a.5.5 0 0 1 .708 0zM1 13.5V16h2.5l7.468-7.468-2.5-2.5L1 13.5z"/>
          </svg>
          Input Data
        </a>
      </li>
    </ul>
  </div>
</nav>

<!-- Top Navbar for small screens -->
<nav class="navbar navbar-expand-lg navbar-dark bg-primary sticky-top shadow d-lg-none">
  <div class="container-fluid">
    <a class="navbar-brand fw-bold" href="#">SMP NEGERI SATAP 4 BANAWA SELATAN</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#sidebarMenu" 
      aria-controls="sidebarMenu" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
  </div>
</nav>

<!-- Main content -->
<main class="container my-5">

  <!-- Section Rekap Data -->
  <section>
    <h2 id="rekap-data" class="mb-4 text-center text-primary">PERANGKAT PEMBELAJARAN SMP NEGERI SATAP 4 BANAWA SELATAN</h2>

    <div class="table-responsive shadow rounded-lg bg-white p-3">
      <table class="table table-striped table-hover table-bordered align-middle text-center">
        <thead class="table-primary">
          <tr>
            <th>NAMA GURU</th>
            <th>NIP</th>
            <th>KELAS</th>
            <th>MEDIA AJAR</th>
            <th>MATA PELAJARAN</th>
          </tr>
        </thead>
        <tbody id="data-body">
          <tr><td colspan="5" class="text-muted">Loading data...</td></tr>
        </tbody>
      </table>
    </div>
  </section>

  <!-- Section Input Data -->
  <section id="input-data" class="mt-5">
    <h2 class="mb-4 text-center text-primary">Form Input Data</h2>
    <div class="d-flex justify-content-center">
      <iframe 
        src="https://docs.google.com/forms/d/e/1FAIpQLSfNkYXRId9W_4G_CHgEseKZJKBCKxo2TLefCCjqaQ6yk_p7pA/viewform?embedded=true" 
        width="100%" 
        height="900" 
        frameborder="0" 
        marginheight="0" 
        marginwidth="0" 
        class="rounded shadow"
        style="max-width:700px;">
        Loadingâ€¦
      </iframe>
    </div>
  </section>

</main>

<script>
  const apiKey = 'AIzaSyC8iMPBQWo6eC87UR7BckmFz0SrSRwm9VU';  // <-- Ganti dengan API key-mu
  const spreadsheetId = '1O-eKCMrnchEsB9FUqDd7G5OV9LBsTYLd-cday2aeWfs';
  const range = encodeURIComponent('Form Responses 1!B2:F');

  const url = `https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId}/values/${range}?key=${apiKey}`;

  // Fungsi cek apakah string mengandung link (http atau https)
  function containsLink(text) {
    return /(https?:\/\/[^\s]+)/g.test(text);
  }

  fetch(url)
    .then(res => res.json())
    .then(data => {
      const tbody = document.getElementById('data-body');
      if (!data.values || data.values.length === 0) {
        tbody.innerHTML = `<tr><td colspan="5" class="text-center text-muted">Data tidak ditemukan.</td></tr>`;
        return;
      }
      tbody.innerHTML = '';

      data.values.forEach(row => {
        // row[0]=B (NAMA GURU), [1]=C (NIP), [2]=D (KELAS), [3]=E (MEDIA AJAR), [4]=F (MATA PELAJARAN)
        const namaGuru = row[0] || '';
        const nip = row[1] || '';
        const kelas = row[2] || '';
        const mediaAjar = row[3] || '';
        const mataPelajaran = row[4] || '';

        let mediaAjarContent = mediaAjar;
        if (containsLink(mediaAjar)) {
          const link = mediaAjar.match(/https?:\/\/[^\s]+/)[0];
          mediaAjarContent = `<a href="${link}" target="_blank" rel="noopener noreferrer" class="text-decoration-none d-inline-flex align-items-center text-primary fw-semibold hover:text-primary-hover">
            <span class="icon-book"></span>lihat dokumen
          </a>`;
        }

        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td class="align-middle">${namaGuru}</td>
          <td class="align-middle">${nip}</td>
          <td class="align-middle">${kelas}</td>
          <td class="align-middle">${mediaAjarContent}</td>
          <td class="align-middle">${mataPelajaran}</td>
        `;
        tbody.appendChild(tr);
      });
    })
    .catch(err => {
      document.getElementById('data-body').innerHTML = `<tr><td colspan="5" class="text-center text-danger">Gagal memuat data: ${err}</td></tr>`;
    });
</script>

<!-- Bootstrap 5 JS Bundle -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>
