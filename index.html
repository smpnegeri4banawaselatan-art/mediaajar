<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>SMP NEGERI SATAP 4 BANAWA SELATAN</title>

<!-- Bootstrap 5 CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />

<!-- Tailwind CSS CDN -->
<script src="https://cdn.tailwindcss.com"></script>

<style>
  /* Override icon-book supaya bisa inline dan kecil */
  .icon-book {
    width: 16px;
    height: 16px;
    display: inline-block;
    background: url('https://cdn-icons-png.flaticon.com/512/29/29302.png') no-repeat center center;
    background-size: contain;
    vertical-align: middle;
    margin-right: 5px;
  }

  /* Sidebar styling */
  #sidebarMenu {
    min-width: 220px;
    max-width: 220px;
    background-color: #0d6efd; /* Bootstrap primary */
  }
  #sidebarMenu .nav-link {
    color: #fff;
  }
  #sidebarMenu .nav-link.active, 
  #sidebarMenu .nav-link:hover {
    background-color: #0b5ed7;
    color: #fff;
  }

  /* Body content padding to the left when sidebar visible on large screens */
  @media (min-width: 992px) {
    body {
      padding-left: 220px;
    }
  }
</style>
</head>
<body class="bg-gray-100">

<!-- Sidebar -->
<nav id="sidebarMenu" class="d-lg-block sidebar collapse position-fixed h-full">
  <div class="position-sticky pt-3">
    <ul class="nav flex-column">
      <li class="nav-item">
        <a class="nav-link active" href="#rekap-data" aria-current="page">
          <svg xmlns="http://www.w3.org/2000/svg" class="me-2 inline-block" width="16" height="16" fill="currentColor" viewBox="0 0 16 16" role="img" aria-label="Dashboard icon">
            <path d="M0 1a1 1 0 0 1 1-1h14a1 1 0 0 1 1 1v14a1 1 0 0 1-1 1H1a1 1 0 0 1-1-1V1zM1 0v16h14V0H1z"/>
            <path d="M4 12h2v-4H4v4zm6 0h2v-7h-2v7zM8 6h2V2H8v4z"/>
          </svg>
          Dashboard Data
        </a>
      </li>
    </ul>
  </div>
</nav>

<!-- Top Navbar for small screens -->
<nav class="navbar navbar-expand-lg navbar-dark bg-primary sticky-top shadow d-lg-none">
  <div class="container-fluid">
    <a class="navbar-brand fw-bold text-truncate" href="#" style="max-width: 80%;">SMP NEGERI SATAP 4 BANAWA SELATAN</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#sidebarMenu" 
      aria-controls="sidebarMenu" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
  </div>
</nav>

<!-- Main content -->
<main class="container mx-auto my-8 px-4 sm:px-6 lg:px-8">

  <!-- Section Rekap Data -->
  <section>
    <h2 id="rekap-data" class="mb-6 text-center text-xl sm:text-2xl font-semibold text-blue-600">PERANGKAT PEMBELAJARAN SMP NEGERI SATAP 4 BANAWA SELATAN</h2>

    <div class="overflow-x-auto shadow rounded-lg bg-white p-4">
      <table class="min-w-full border border-gray-300 text-center align-middle table-auto text-sm sm:text-base">
        <thead class="bg-blue-500 text-white">
          <tr>
            <th class="px-2 sm:px-4 py-2 border border-blue-600">NAMA GURU</th>
            <th class="px-2 sm:px-4 py-2 border border-blue-600">NIP</th>
            <th class="px-2 sm:px-4 py-2 border border-blue-600">KELAS</th>
            <th class="px-2 sm:px-4 py-2 border border-blue-600">MEDIA AJAR</th>
            <th class="px-2 sm:px-4 py-2 border border-blue-600">MATA PELAJARAN</th>
          </tr>
        </thead>
        <tbody id="data-body" class="divide-y divide-gray-200">
          <tr><td colspan="5" class="text-gray-500 py-6">Loading data...</td></tr>
        </tbody>
      </table>
    </div>
  </section>

</main>

<script>
  const apiKey = 'AIzaSyC8iMPBQWo6eC87UR7BckmFz0SrSRwm9VU';  // <-- Ganti dengan API key-mu
  const spreadsheetId = '1O-eKCMrnchEsB9FUqDd7G5OV9LBsTYLd-cday2aeWfs';
  const range = encodeURIComponent('Form Responses 1!B2:F');
  const url = `https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId}/values/${range}?key=${apiKey}`;

  function containsLink(text) {
    return /(https?:\/\/[^\s]+)/g.test(text);
  }

  async function loadData() {
    const tbody = document.getElementById('data-body');
    tbody.innerHTML = `<tr><td colspan="5" class="text-gray-500 py-6">Loading data...</td></tr>`;
    try {
      const res = await fetch(url);
      const data = await res.json();
      if (!data.values || data.values.length === 0) {
        tbody.innerHTML = `<tr><td colspan="5" class="text-center text-gray-500 py-6">Data tidak ditemukan.</td></tr>`;
        return;
      }
      tbody.innerHTML = '';
      data.values.forEach(row => {
        const namaGuru = row[0] || '';
        const nip = row[1] || '';
        const kelas = row[2] || '';
        const mediaAjar = row[3] || '';
        const mataPelajaran = row[4] || '';

        let mediaAjarContent = mediaAjar;
        if (containsLink(mediaAjar)) {
          const link = mediaAjar.match(/https?:\/\/[^\s]+/)[0];
          mediaAjarContent = `<a href="${link}" target="_blank" rel="noopener noreferrer" class="inline-flex items-center text-blue-600 hover:underline font-semibold">
            <span class="icon-book"></span>lihat dokumen
          </a>`;
        }

        const tr = document.createElement('tr');
        tr.className = 'hover:bg-blue-50';
        tr.innerHTML = `
          <td class="border border-gray-300 px-2 sm:px-4 py-2 break-words">${namaGuru}</td>
          <td class="border border-gray-300 px-2 sm:px-4 py-2 break-words">${nip}</td>
          <td class="border border-gray-300 px-2 sm:px-4 py-2 break-words">${kelas}</td>
          <td class="border border-gray-300 px-2 sm:px-4 py-2 break-words">${mediaAjarContent}</td>
          <td class="border border-gray-300 px-2 sm:px-4 py-2 break-words">${mataPelajaran}</td>
        `;
        tbody.appendChild(tr);
      });
    } catch (err) {
      tbody.innerHTML = `<tr><td colspan="5" class="text-center text-red-600 py-6">Gagal memuat data: ${err}</td></tr>`;
    }
  }

  // Load data pertama kali
  loadData();

  // Refresh data setiap 3 menit (180000 ms)
  setInterval(loadData, 180000);
</script>

<!-- Bootstrap 5 JS Bundle -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>
